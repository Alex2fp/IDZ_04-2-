# Отчёт по ИДЗ №4 (вариант «Болтуны», C)

**Исполнитель:** студент 2 курса.  
**Синхронизация:** две реализации — (1) семафоры/мьютексы и (2) условные переменные + барьеры + атомарные флаги.  
**Ввод:** CLI или конфигурационный файл `key=value`.  
**Вывод:** консоль и файл одновременно.

## Сценарий предметной области
- В сети подключено N болтунов (потоков), каждый с персональным телефоном.
- Болтун случайно ждёт или инициирует звонок. При наборе выбирает случайного абонента, пропуская себя и отключившихся.
- Если линия адресата занята, немедленно пытается другой номер до успешного соединения или истечения времени.
- Длительность каждого разговора случайна в указанном диапазоне. После разговора болтун может отключиться с вероятностью `p` или по достижении лимита разговоров. Последний ушедший завершает симуляцию и освобождает ресурсы.
- Программа также завершается по тайм-ауту или сигналу Ctrl+C.

## Модели параллельных вычислений
- **Общие структуры:** массив состояний линий, счётчики разговоров, атомарный счётчик активных участников, таймер старта.
- **Семафорная версия (`--mode semaphore`):**
  - Двоичный семафор входящих для каждого болтуна, семафор отклика, мьютекс на состояние линии.
  - Звонящий помечает обе линии как занятые, кладёт заявку и ждёт отклика. Оба потока спят заданную длительность, затем каждый освобождает свою линию. При занятости фиксируется попытка и выбирается другой номер.
- **Condition/Barrier версия (`--mode condition`):**
  - `pthread_cond_t` для ожидания входящего вызова, атомарный флаг остановки, барьер для синхронного начала разговора (уникальный на каждое соединение).
  - Остальная логика идентична первой модели, что обеспечивает сопоставимость поведения.

## Входные данные
Настраиваемые параметры (пример в `configs/*.conf`):
- `talkers` — стартовое число болтунов (1–64);
- `min_idle_ms` / `max_idle_ms` — пауза ожидания перед действием;
- `min_call_ms` / `max_call_ms` — длительность разговора;
- `stop_after_calls` — принудительное отключение после указанного числа разговоров (0 — отключение не обязательно);
- `leave_probability` — вероятность ухода после любого разговора;
- `duration_seconds` — ограничение по времени работы;
- `output` — путь файла лога;
- `mode` — `semaphore` или `condition`.
CLI-параметры перекрывают значения конфигурационного файла. Примеры запусков:
```
./talkers --config configs/semaphore.conf
./talkers --config configs/condition.conf --mode condition
./talkers --mode semaphore -n 5 --min-idle 150 --max-idle 700 --min-call 300 --max-call 900 \
  --leave-probability 0.2 --duration 6 --output outputs/run.log
```

## Протокол работы
- Лог фиксирует подключение участников, наборы номера, занятые линии, начало и завершение разговоров, уходы и финал симуляции.
- При занятости линии выполняется мгновенный повторный выбор адресата, что видно в журналах.
- Последний болтун завершает работу сети (децентрализованное освобождение ресурсов). Дополнительно отлавливается SIGINT для корректного выхода.

## Примеры входных/выходных файлов
- `configs/semaphore.conf` ↔ `outputs/sample_semaphore.log`
- `configs/condition.conf` ↔ `outputs/sample_condition.log`
- `configs/balanced.conf` ↔ `outputs/sample_balanced.log`

Каждый журнал демонстрирует случайные длительности звонков, повторные попытки при занятости и завершение симуляции при уходе последнего участника или по таймеру.
